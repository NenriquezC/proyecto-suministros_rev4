<div class="card mb-3">
  <div class="card-header">
    <h2 class="card-title">Datos de la venta</h2>
  </div>

  <div class="card-body">
    {# --- ERRORES GENERALES DEL FORM --- #}
    {% if form.non_field_errors %}
      <div class="alert alert-danger">{{ form.non_field_errors }}</div>
    {% endif %}

    <div class="form-rows-2col">
      {# Cliente * (User) #}
      {% if form.cliente %}
        <label for="{{ form.cliente.id_for_label }}" class="form-label-left">
          Cliente <span class="req"></span>
        </label>
        <div class="form-field">
          {{ form.cliente }}
          {% for error in form.cliente.errors %}
            <div class="invalid-feedback d-block">{{ error }}</div>
          {% endfor %}
        </div>
      {% endif %}

{# ===== Fecha (funciona en agregar, editar y readonly) ===== #}
{% if form.fecha %}
  <label for="{{ form.fecha.id_for_label }}" class="form-label-left">
    Fecha <span class="req"></span>
  </label>
  <div class="form-field">
    {% if readonly %}
      {# 1) Si el form tiene instancia con fecha, úsala #}
      {% if form.instance and form.instance.fecha %}
        <input type="date" value="{{ form.instance.fecha|date:'Y-m-d' }}" disabled>
      {# 2) Si llega 'venta' en el contexto (editar/ver), úsala #}
      {% elif venta and venta.fecha %}
        <input type="date" value="{{ venta.fecha|date:'Y-m-d' }}" disabled>
      {# 3) Sin valor: deja el input vacío deshabilitado para mantener la visual #}
      {% else %}
        <input type="date" value="" disabled>
      {% endif %}
    {% else %}
      {{ form.fecha }}
      {% for error in form.fecha.errors %}
        <div class="invalid-feedback d-block">{{ error }}</div>
      {% endfor %}
    {% endif %}
  </div>
{% endif %}
      {# Descuento total (Decimal) #}
      {% if form.descuento_total %}
        <label for="{{ form.descuento_total.id_for_label }}" class="form-label-left">
          Descuento (%)
        </label>
        <div class="form-field">
          {{ form.descuento_total }}
          {% for error in form.descuento_total.errors %}
            <div class="invalid-feedback d-block">{{ error }}</div>
          {% endfor %}
        </div>
      {% endif %}





      {# Impuesto (%) — en readonly mostrar como porcentaje (ej. 23.00 %), no como dinero #}
      {% if form.impuesto %}
        <label for="{{ form.impuesto.id_for_label }}" class="form-label-left">Impuesto (%)</label>
        <div class="form-field">
          {% if readonly %}
            <input type="text"
                  class="form-control"
                  value="{{ impuesto_porcentaje|default:venta.impuesto_porcentaje|floatformat:2 }}"
                  disabled>

          {% else %}
            {{ form.impuesto }}
            {% for error in form.impuesto.errors %}
              <div class="invalid-feedback d-block">{{ error }}</div>
            {% endfor %}
          {% endif %}
        </div>
      {% endif %}









{# Ganancia fija (50) — idéntica a Impuesto #}
<label for="id_ganancia_pct" class="form-label-left">Ganancia (%)</label>
<div class="form-field">
  <input
    type="number"
    name="ganancia_pct"
    id="id_ganancia_pct"
    class="form-control"
    value="50"
    step="0.01" min="0" max="100"
    readonly
  >
</div>


    </div>
  </div>
</div>