{% extends "base.html" %}
{% load static %}

{% block title %}Proveedores · {% if readonly %}Ver{% else %}Editar{% endif %} #{{ proveedor.pk }}{% endblock %}

{% block extra_head %}
<link rel="stylesheet" href="{% static 'css/global.css' %}">
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
<style>
.container { max-width: 1200px; }
.page-header { margin: 24px 0 12px; }
.page-title { margin: 0; color: #094067; font-weight: 700; }
.page-subtitle { margin: 6px 0 0; color: #6c757d; }
.card { border-radius: 10px; box-shadow: 0 2px 18px rgba(44,62,80,0.08); border: 1px solid #dfe6e9; }
.card-header { background: #3a5068; color: #fff; border-bottom: 1px solid #dfe6e9; }
.card-title { margin: 0; font-size: 1.12rem; font-weight: 700; }
.card-header--flex { display:flex; justify-content: space-between; align-items:center; }
.totals-card { max-width: 420px; margin-left: auto; }
.totals-row { display:flex; justify-content: space-between; }
.totals-row--strong { font-weight: 700; font-size: 1.05rem; }
</style>
{% endblock %}

{% block content %}
<div class="container">


{% if readonly %}
  {# ================== READONLY (ESPEJO DE PRODUCTOS) ================== #}
  <div class="page-header">
    <h1 class="page-title">PROVEEDOR INGRESADO N°:{{ proveedor.pk }}</h1>
    <p class="page-subtitle">Visualización del proveedor (solo lectura)</p>
  </div>

{# Mensajes justo debajo del título #}
  {% if messages %}
    <div class="mb-3" style="max-width: 980px; margin: 0 auto;">
      {% for message in messages %}
        <div class="alert
                    {% if message.tags == 'error' %}alert-danger
                    {% elif message.tags == 'success' %}alert-success
                    {% elif message.tags %}alert-{{ message.tags }}
                    {% else %}alert-info{% endif %}" role="alert">
          {{ message }}
        </div>
      {% endfor %}
    </div>
  {% endif %}





  {# Deja los mensajes SOLO en base.html si no quieres duplicados #}

  <div class="card mb-3">
    <div class="card-header card-header--flex" style="background:#3a5068;color:#fff;">
      <h2 class="card-title" style="color:#fff;">Datos del proveedor</h2>
    </div>

    <div class="card-body">
      <form onsubmit="return false">
        <fieldset disabled>
          <div class="form-rows-2col" style="display:grid;grid-template-columns:240px 1fr;column-gap:16px;row-gap:12px;align-items:center;">
            <label class="form-label-left">Nombre</label>
            <div class="form-field">{{ form.nombre }}</div>

            <label class="form-label-left">Email</label>
            <div class="form-field">{{ form.email }}</div>

            <label class="form-label-left">Teléfono</label>
            <div class="form-field">{{ form.telefono }}</div>

            {% if form.direccion %}
              <label class="form-label-left">Dirección</label>
              <div class="form-field">{{ form.direccion }}</div>
            {% endif %}

            <label class="form-label-left">Tipo de proveedor</label>
            <div class="form-field">{{ form.tipo_proveedor }}</div>

            {% if form.rut %}
              <label class="form-label-left">RUT</label>
              <div class="form-field">{{ form.rut }}</div>
            {% endif %}
          </div>
        </fieldset>
      </form>

      <div class="mt-3">
        {% include "inventario/proveedores/editar_proveedor/_partials/_editar_proveedor_acciones.html" with proveedor=proveedor readonly=True %}
      </div>
    </div>
  </div>

{% else %}
  {# ================== EDICIÓN ================== #}
  <div class="page-header">
    <h1 class="page-title">EDITAR PROVEEDOR N°:{{ proveedor.pk }}</h1>
    <p class="page-subtitle">Modifica los datos del proveedor</p>
  </div>




    {# Mensajes y errores de formulario bajo el título #}
  {% if messages %}
    <div class="mb-3" style="max-width: 980px; margin: 0 auto;">
      {% for message in messages %}
        <div class="alert
                    {% if message.tags == 'error' %}alert-danger
                    {% elif message.tags == 'success' %}alert-success
                    {% elif message.tags %}alert-{{ message.tags }}
                    {% else %}alert-info{% endif %}" role="alert">
          {{ message }}
        </div>
      {% endfor %}
    </div>
  {% endif %}

  {% if form.non_field_errors %}
    <div class="alert alert-danger mb-3" style="max-width: 980px; margin: 0 auto;">
      {{ form.non_field_errors }}
    </div>
  {% endif %}






  <form method="post" novalidate>
    {% csrf_token %}

    <div class="card mb-3">
      <div class="card-header card-header--flex">
        <h2 class="card-title">Datos del proveedor</h2>
      </div>

      <div class="card-body">
        <div class="table-responsive">
          <table class="table table-borderless align-middle">
            <tbody>
              <tr><th class="w-25">Nombre</th>     <td class="text-end">{{ form.nombre }}</td></tr>
              <tr><th>Email</th>                   <td class="text-end">{{ form.email }}</td></tr>
              <tr><th>Teléfono</th>                <td class="text-end">{{ form.telefono }}</td></tr>
              {# Ajusta/añade campos reales de tu modelo Proveedor #}
              {% if form.direccion %}<tr><th>Dirección</th><td class="text-end">{{ form.direccion }}</td></tr>{% endif %}
              <tr><th class="w-25">Tipo de proveedor</th><td class="text-end">{{ form.tipo_proveedor }}</td></tr>
              {% if form.rut %}<tr><th>RUT</th><td class="text-end">{{ form.rut }}</td></tr>{% endif %}
            </tbody>
          </table>
        </div>

        <div class="mt-3 text-center">
          {% include "inventario/proveedores/editar_proveedor/_partials/_editar_proveedor_acciones.html" with proveedor=proveedor %}
        </div>
      </div>
    </div>
  </form>
{% endif %}

</div>
{% endblock %}

{% block scripts %}
<script>console.log('[inventario/proveedores] {{ readonly|default_if_none:False|yesno:"detalle readonly,edición" }}');</script>
{% endblock %}